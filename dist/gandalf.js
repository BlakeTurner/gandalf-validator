"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),React=require("react"),Gandalf=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.state={fields:e},r.timeOuts={},r.errorMessages={required:"This field is required",numeric:"This value must be a number",email:"This value must an email address"},r.validators={required:function(e){return!e},numeric:function(e){return isNaN(e)},email:function(e){return!/.+@.+\..+/.test(e)}},r}return _inherits(t,e),_createClass(t,[{key:"componentWillMount",value:function(){var e=this,t=Object.keys(this.state.fields);t.forEach(function(t){return e.augmentFieldData(t)}),this.setState({fields:Object.assign({},this.state.fields)},function(){t.forEach(function(t){return e.createField(t)})})}},{key:"getErrorMessage",value:function(e){var t=this,r=this.state.fields[e],n=r.value,a=r.validators,i=a.find(function(e){return t.validators[e](n)});return this.errorMessages[i]}},{key:"createField",value:function(e){var t=this.state.fields[e];t.element=this.buildFieldElement(t),this.updateFieldState(t)}},{key:"augmentFieldData",value:function(e){var t=this.state.fields[e],r=t.component,n=t.props,a=void 0===n?{}:n,i=t.validators,s=t.debounce,o=t.errorPropName,u=void 0===o?"error":o,l=t.errorPropIsBool,c=void 0!==l&&l,f={key:e,name:e,component:r,validators:i,errorPropName:u,errorPropIsBool:c,debounce:s,originalProps:a,errorMessage:"",value:""};this.state.fields=Object.assign({},this.state.fields,_defineProperty({},e,f))}},{key:"buildElementProps",value:function(e){var t,r=this.state.fields[e];return t={name:e,key:e,onChange:this.createChangeListener(e)},_defineProperty(t,r.errorPropName,r.errorPropIsBool?!!r.errorMessage:r.errorMessage),_defineProperty(t,"value",r.value),t}},{key:"createChangeListener",value:function(e){var t=this;return function(r){t.handleChange({name:e,value:r.target.value})}}},{key:"handleChange",value:function(e){var t=e.name,r=e.value,n=e.skipDebounce,a=this.state.fields[t];a.value=r,a.debounce&&!n?this.handleDebounce(t):a.errorMessage=this.getErrorMessage(t),a.element=this.buildFieldElement(a),this.updateFieldState(a)}},{key:"handleDebounce",value:function(e){var t=this,r=this.state.fields[e];clearTimeout(this.timeOuts[e]),this.timeOuts[e]=setTimeout(function(){r.errorMessage=t.getErrorMessage(e),r.element=t.buildFieldElement(r),t.updateFieldState(r)},r.debounce)}},{key:"buildFieldElement",value:function(e){return React.createElement(e.component,Object.assign({},e.originalProps,this.buildElementProps(e.name)))}},{key:"updateFieldState",value:function(e){this.setState({fields:Object.assign({},this.state.fields,_defineProperty({},e.name,e))})}},{key:"formIsValid",value:function(){var e=this;return!Object.keys(this.state.fields).find(function(t){return e.state.fields[t].errorMessage})}},{key:"runManualFormValidation",value:function(){var e=this;Object.keys(this.state.fields).forEach(function(t){var r=e.state.fields[t];e.handleChange({name:t,value:r.value,skipDebounce:!0})})}},{key:"getFormData",value:function(){var e=this;return Object.keys(this.state.fields).reduce(function(t,r){var n=e.state.fields[r];return t[r]=n.value,t},{})}},{key:"getCleanFormData",value:function(){return this.runManualFormValidation(),!!this.formIsValid()&&this.getFormData()}}]),t}(React.Component);module.exports=Gandalf;